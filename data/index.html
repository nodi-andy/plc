<html>
<head>
	<link rel="stylesheet" type="text/css" href="litegraph.css">
	<script type="text/javascript" src="math.js"></script>
	<script type="text/javascript" src="index.js"></script>
	<script type="module" src="litegraph.js"></script>
</head>
<body style='width:100%; height:100%'>
	<canvas id='mycanvas' width='100%' height='100%'></canvas>
	<div class="menu-container">
		<div title = "Add new node" id="addButton" class="menu-button">
			<svg width="48px" height="48px" viewBox="-2.4 -2.4 28.80 28.80" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000" stroke-width="1.488" transform="rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="0.144"></g><g id="SVGRepo_iconCarrier"> <g id="style=bulk"> <g id="add"> <path id="rectangle" d="M1.25 7.25C1.25 3.93629 3.93629 1.25 7.25 1.25H16.75C20.0637 1.25 22.75 3.93629 22.75 7.25V16.75C22.75 20.0637 20.0637 22.75 16.75 22.75H7.25C3.93629 22.75 1.25 20.0637 1.25 16.75V7.25Z" fill="#BFBFBF"></path> <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M12.0248 6.32349C12.3578 6.32349 12.6277 6.59345 12.6277 6.92646L12.6277 16.8281C12.6277 17.1611 12.3577 17.431 12.0247 17.431C11.6917 17.431 11.4218 17.1611 11.4218 16.8281L11.4218 6.92645C11.4218 6.59344 11.6918 6.32349 12.0248 6.32349Z" fill="#000000"></path> <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M17.8486 12.0044C17.8486 12.3553 17.5641 12.6398 17.2132 12.6398L6.77865 12.6398C6.42771 12.6398 6.14323 12.3553 6.14323 12.0043C6.14323 11.6534 6.42772 11.3689 6.77865 11.3689L17.2132 11.369C17.5641 11.369 17.8486 11.6535 17.8486 12.0044Z" fill="#000000"></path> </g> </g> </g></svg>
		</div>
		<div title = "Remove the node"  id="remButton" class="menu-button">
			<svg width="48px" height="48px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ff0000" stroke-width="1.08"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="style=bulk"> <g id="close"> <path id="rectangle" d="M1.25 7.25C1.25 3.93629 3.93629 1.25 7.25 1.25H16.75C20.0637 1.25 22.75 3.93629 22.75 7.25V16.75C22.75 20.0637 20.0637 22.75 16.75 22.75H7.25C3.93629 22.75 1.25 20.0637 1.25 16.75V7.25Z" fill="#BFBFBF"></path> <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M7.18298 7.18298C7.42696 6.93901 7.82253 6.93901 8.06651 7.18298L16.817 15.9335C17.061 16.1775 17.061 16.573 16.817 16.817C16.573 17.061 16.1775 17.061 15.9335 16.817L7.18298 8.06651C6.93901 7.82253 6.93901 7.42696 7.18298 7.18298Z" fill="#ff0000"></path> <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M16.817 7.18299C17.061 7.42697 17.061 7.82254 16.817 8.06652L8.0665 16.817C7.82252 17.061 7.42695 17.061 7.18298 16.817C6.939 16.573 6.93901 16.1775 7.18299 15.9335L15.9335 7.18298C16.1775 6.939 16.573 6.93901 16.817 7.18299Z" fill="#ff0000"></path> </g> </g> </g></svg>
		</div>
		<!-- <div class="menu-button">â¤ž</div> -->
		<div title = "Save nodework to local memory" id="saveButton" class="menu-button">
			<svg width="48px" height="48px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M3.87868 3.87868C3 4.75736 3 6.17157 3 9V15C3 17.8284 3 19.2426 3.87868 20.1213C4.52055 20.7632 5.44818 20.9362 7.0041 20.9828C7 20.687 7 20.3607 7 20V19C7 17.1144 7 16.1716 7.58579 15.5858C8.17157 15 9.11438 15 11 15H12C13.8856 15 14.8284 15 15.4142 15.5858C16 16.1716 16 17.1144 16 19V20C16 20.367 16 20.6984 15.9957 20.9983C18.1735 20.9863 19.3524 20.8902 20.1213 20.1213C21 19.2426 21 17.8284 21 15V7.82843C21 7.41968 21 7.2153 20.9239 7.03153C20.8478 6.84776 20.7032 6.70325 20.4142 6.41423L20.4142 6.41421L17.5858 3.58579C17.2968 3.29676 17.1522 3.15224 16.9685 3.07612C16.7847 3 16.5803 3 16.1716 3H9C6.17157 3 4.75736 3 3.87868 3.87868Z" fill="#2A4157" fill-opacity="0.24"></path> <path d="M16 21V19C16 17.1144 16 16.1716 15.4142 15.5858C14.8284 15 13.8856 15 12 15H11C9.11438 15 8.17157 15 7.58579 15.5858C7 16.1716 7 17.1144 7 19V21" stroke="#222222" stroke-width="1.2"></path> <path d="M7 8H12" stroke="#222222" stroke-width="1.2" stroke-linecap="round"></path> <path d="M3 9C3 6.17157 3 4.75736 3.87868 3.87868C4.75736 3 6.17157 3 9 3H16.1716C16.5803 3 16.7847 3 16.9685 3.07612C17.1522 3.15224 17.2968 3.29676 17.5858 3.58579L20.4142 6.41421C20.7032 6.70324 20.8478 6.84776 20.9239 7.03153C21 7.2153 21 7.41968 21 7.82843V15C21 17.8284 21 19.2426 20.1213 20.1213C19.2426 21 17.8284 21 15 21H9C6.17157 21 4.75736 21 3.87868 20.1213C3 19.2426 3 17.8284 3 15V9Z" stroke="#222222" stroke-width="1.2"></path> </g></svg>
		</div>
	<div title = "Show node properties"  id="editButton" class="menu-button">
		<svg width="48px" height="48px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M20.8506 12.0002V6.50992C20.8506 4.48846 19.2118 2.84973 17.1904 2.84973H6.5098C4.48833 2.84973 2.84961 4.48845 2.84961 6.50992V17.4905C2.84961 19.512 4.48833 21.1507 6.5098 21.1507H11.8501" stroke="#1C1C1C" stroke-width="1.69904" stroke-linecap="round"></path> <path d="M7.00269 12H10.0018" stroke="#1C1C1C" stroke-width="1.69904" stroke-linecap="round"></path> <path d="M7.00269 8.0022H12.9993" stroke="#1C1C1C" stroke-width="1.69904" stroke-linecap="round"></path> <path d="M20.79 15.8827L18.8369 13.8971C18.6389 13.6957 18.3177 13.6957 18.1196 13.8971L14.3632 17.716C14.2545 17.8266 14.201 17.9813 14.2177 18.1368L14.4325 20.1323C14.4455 20.2525 14.5388 20.3474 14.657 20.3605L16.6198 20.5789C16.7727 20.5959 16.9249 20.5415 17.0337 20.431L20.79 16.612C20.9881 16.4106 20.9881 16.0841 20.79 15.8827Z" stroke="#DF1463" stroke-width="1.69904" stroke-linecap="round"></path> </g></svg>
	</div>
	<div title = "Send nodework to the IoT" id="burnButton" class="menu-button">
		<svg fill="#000000" width="48px" height="48px" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><defs><style>.cls-1{fill:none;}</style></defs><path d="M30,19H26V15H24v9H8V8l9-.0009V6H13V2H11V6H8A2.002,2.002,0,0,0,6,8v3H2v2H6v6H2v2H6v3a2.0023,2.0023,0,0,0,2,2h3v4h2V26h6v4h2V26h3a2.0027,2.0027,0,0,0,2-2V21h4Z"></path><path d="M21,21H11V11H21Zm-8-2h6V13H13Z"></path><path d="M31,13H29A10.0117,10.0117,0,0,0,19,3V1A12.0131,12.0131,0,0,1,31,13Z"></path><path d="M26,13H24a5.0059,5.0059,0,0,0-5-5V6A7.0085,7.0085,0,0,1,26,13Z"></path><rect id="_Transparent_Rectangle_" data-name="<Transparent Rectangle>" class="cls-1" width="32" height="32"></rect></g></svg>
	</div>
</div>
<script type="module">
	import { LGraph } from "./litegraph.js"
	window.graph = new LGraph();
	window.canvas = new LGraphCanvas("#mycanvas", graph);
	// Get all the button divs
	const buttons = document.querySelectorAll('.menu-button');

	// Loop through each button div and add an event listener to it
	buttons.forEach(button => {
	  button.addEventListener('mousedown', () => {
		// Remove the "active" class from all button divs
		buttons.forEach(button => button.classList.remove('active'));

		// Add the "active" class to the clicked button div
		button.classList.add('active');
	  });
	  button.addEventListener('mouseup', () => {
		// Remove the "active" class from all button divs
		///buttons.forEach(button => button.classList.remove('active'));

		// Add the "active" class to the clicked button div
		button.classList.remove('active');
	  });
	});

	document.getElementById("addButton").onclick = () => {
		document.getElementById("toolBox").style.display = "block";
	}
	document.getElementById("remButton").onclick = () => {

        var graph = window.graph;
        graph.beforeChange();


        var fApplyMultiNode = function (node) {
            if (node.removable === false) {
                return;
            }
            graph.remove(node);
        };

        var graphcanvas = LGraphCanvas.active_canvas;
            for (var i in graphcanvas.selected_nodes) {
                fApplyMultiNode(graphcanvas.selected_nodes[i]);
            }

        graph.afterChange();
		if (graphcanvas.selected_nodes && graphcanvas.selected_nodes[0]) {
        	graphcanvas.selected_nodes[0].setDirtyCanvas(true, true);
		}
	}
	document.getElementById("burnButton").onclick = () => {
		saveMap();
	}
	document.getElementById("saveButton").onclick = () => {
		localStorage.setItem( "noditron", JSON.stringify( graph.serialize() )); 
	}
	document.getElementById("editButton").onclick = () => {
		window.canvas.processContextMenu();
	}

	graph.start()
	canvas.showSearchBox();

	window.addEventListener('resize', function () { canvas.resize() })

	import "./nodes/data/bit.js"
	import "./nodes/data/number.js"
	import "./nodes/math/counter.js"
	import "./nodes/control/junction.js"
	import "./nodes/control/selector.js"
	import "./nodes/logic/and.js"
	import "./nodes/time/interval.js"
	import "./nodes/widget/button.js"
	import "./nodes/widget/stepper.js"
	import "./nodes/widget/toggle.js"
	import "./nodes/nodi.box/b1.js"
	import "./nodes/nodi.box/b2.js"
	import "./nodes/nodi.box/b3.js"
	import "./nodes/nodi.box/b4.js"
	import "./nodes/nodi.box/yellow.js"
	import "./nodes/nodi.box/red.js"

</script>
</body>
</html>